"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e,t,o=require("react");exports.ScrollAxisName=void 0,(e=exports.ScrollAxisName||(exports.ScrollAxisName={})).VERTICAL="vertical",e.HORIZONTAL="horizontal",exports.ScrollDirection=void 0,(t=exports.ScrollDirection||(exports.ScrollDirection={})).UP="up",t.DOWN="down",t.LEFT="left",t.RIGHT="right";const l=e=>"number"==typeof e?e<0?-1:1:e?-1:1,r=({newValue:e,scrollSize:t,fallbackValue:o})=>{const r=null!=o?o:t*l(e);return Math.abs(e)>t?r:e},n=({ref:e,windowScroll:t})=>{const o={scrollingElement:null,registerEventListener:null};if(!t&&e){let t=null;"_scrollingContainer"in e&&(t=e._scrollingContainer),"Grid"in e&&(t=e.Grid._scrollingContainer),"scrollHeight"in e&&(t=e),o.scrollingElement=t,o.registerEventListener=t}else t&&(o.scrollingElement=document.scrollingElement,o.registerEventListener=document);return o},i=e=>{const{scrollingElement:t,registerEventListener:o}=e;return!(t&&o&&("number"!=typeof t.scrollHeight||"number"!=typeof t.scrollWidth||"number"!=typeof t.scrollLeft||"number"!=typeof t.scrollTop||"number"!=typeof t.clientHeight||"number"!=typeof t.clientWidth||"function"!=typeof o.addEventListener||"function"!=typeof o.removeEventListener)||!t||!o)||(console.error("Sorry I can't use this container - try using a different DOM element."),!1)},s=e=>{const{state:{clientWidth:t,clientHeight:o},props:{scrollThreshold:l=1},_scrollingContainerRef:n}=e;if(!(null==n?void 0:n.scrollingElement)||t===n.scrollingElement.clientWidth&&o===n.scrollingElement.clientHeight)return;const{clientWidth:i,clientHeight:s,scrollHeight:c,scrollWidth:a}=n.scrollingElement;let h={vertical:0,horizontal:0};if("string"==typeof l){const e=Math.abs(parseInt(l));h={vertical:r({newValue:e,scrollSize:c,fallbackValue:s}),horizontal:r({newValue:e,scrollSize:a,fallbackValue:i})}}else{const e=l>1?1:l<=0?.1:l;h={vertical:e*s,horizontal:e*i}}e.state.computedScrollThreshold=h,e.state.clientWidth=i,e.state.clientHeight=s},c=(e,t,o)=>Math.abs(e)<=t-o,a=(e,t,o,l,r)=>Math.abs(e)>=Math.abs(t-o-l-r),h=(e,t)=>{var o;s(e);const l=null!==(o=null==t?void 0:t.offset)&&void 0!==o?o:0,{state:{clientHeight:r,clientWidth:n,computedScrollThreshold:{vertical:i,horizontal:h}},props:{reverse:u={}},_scrollingContainerRef:d}=e;if(!(null==d?void 0:d.scrollingElement))return Object.values(exports.ScrollDirection).reduce(((e,t)=>Object.assign(Object.assign({},e),{[t]:!1})),{});const{scrollHeight:p,scrollWidth:f,scrollLeft:g,scrollTop:v}=d.scrollingElement,{column:m,row:C}=u;return{[m?exports.ScrollDirection.DOWN:exports.ScrollDirection.UP]:c(v,i,l),[m?exports.ScrollDirection.UP:exports.ScrollDirection.DOWN]:a(v,p,r,i,l),[C?exports.ScrollDirection.RIGHT:exports.ScrollDirection.LEFT]:c(g,h,l),[C?exports.ScrollDirection.LEFT:exports.ScrollDirection.RIGHT]:a(g,f,n,h,l)}};function u(e,t,o,l){return new(o||(o=Promise))((function(r,n){function i(e){try{c(l.next(e))}catch(e){n(e)}}function s(e){try{c(l.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(i,s)}c((l=l.apply(e,t||[])).next())}))}const d=(e,{direction:t,offset:o,hardReset:l})=>{(!h(e,{offset:o})[t]&&e.state.thresholdReached[t]||l)&&(e.state.thresholdReached[t]=!1)},p=(e,{scrollTop:t,scrollLeft:o})=>{var l;if(!(null===(l=e._scrollingContainerRef)||void 0===l?void 0:l.scrollingElement))return;const{scrollHeight:n,scrollWidth:i}=e._scrollingContainerRef.scrollingElement;void 0!==t&&(e._scrollingContainerRef.scrollingElement.scrollTop=r({newValue:t,scrollSize:n})),void 0!==o&&(e._scrollingContainerRef.scrollingElement.scrollLeft=r({newValue:o,scrollSize:i}))},f=(e,{axis:t,loadMore:o})=>{var r;if(!(null===(r=e._scrollingContainerRef)||void 0===r?void 0:r.scrollingElement)||!e.state.isLoading)return;const n=t===exports.ScrollAxisName.VERTICAL,{state:{rowCount:i=0,columnCount:s=0,scrollHeight:c,scrollWidth:a},props:{rowCount:h=0,columnCount:u=0,reverse:f={}},_scrollingContainerRef:g}=e,{scrollTop:v,scrollLeft:m,scrollHeight:C,scrollWidth:x,clientHeight:S,clientWidth:E}=g.scrollingElement,R=n?h:u,L=n?v:m,w=n?C:x,D=n?c:a,T=n?S:E;if((n?i:s)!==R&&Math.abs(L)<T){const t=l(f[n?"column":"row"]);p(e,{["scroll"+(n?"Top":"Left")]:L+(w-D)*t})}Object.values(exports.ScrollDirection).forEach((t=>d(e,{direction:t}))),e.state[n?"scrollHeight":"scrollWidth"]=w,e.state[n?"rowCount":"columnCount"]=R,e.state.isLoading=!1,setTimeout((()=>o(e)),100)},g=(e,{positiveDirection:t,negativeDirection:o,offset:l,loadMore:r})=>u(void 0,void 0,void 0,(function*(){const{state:{isLoading:n,thresholdReached:i},props:{next:s,hasMore:c}}=e,a=t===exports.ScrollDirection.UP?exports.ScrollAxisName.VERTICAL:exports.ScrollAxisName.HORIZONTAL;if(!n){const n=c[t]&&!i[t]&&l[t],h=!n&&c[o]&&!i[o]&&l[o];if(n||h)try{const l=n?t:o;e.state.thresholdReached[l]=!0,e.state.isLoading=!0,yield s(l)}finally{setTimeout((()=>f(e,{axis:a,loadMore:r})),100)}}})),v=e=>{const{_scrollingContainerRef:t}=e;if(!t)return;e.state.isLoading||Object.values(exports.ScrollDirection).forEach((t=>d(e,{direction:t,offset:0,hardReset:!0})));const o=h(e);g(e,{positiveDirection:exports.ScrollDirection.UP,negativeDirection:exports.ScrollDirection.DOWN,offset:o,loadMore:v}),g(e,{positiveDirection:exports.ScrollDirection.LEFT,negativeDirection:exports.ScrollDirection.RIGHT,offset:o,loadMore:v})};class m{constructor(e){this._setRef=function(e){const{windowScroll:t}=this.props,o=n({ref:e,windowScroll:t});if(!i(o))return;this._scrollingContainerRef=o;const l=()=>{var e;if(!(null===(e=this._scrollingContainerRef)||void 0===e?void 0:e.scrollingElement))return;const{_scrollingContainerRef:{scrollingElement:t},props:{onScroll:o}}=this,{scrollHeight:l,scrollWidth:r,scrollLeft:n,scrollTop:i,clientHeight:s,clientWidth:c}=t;o&&o({clientHeight:s,clientWidth:c,scrollHeight:l,scrollWidth:r,scrollLeft:n,scrollTop:i}),this.state.isLoading||v(this)};this.state.rowCount=this.props.rowCount,this.state.columnCount=this.props.columnCount,this.state.scrollHeight=this._scrollingContainerRef.scrollingElement.scrollHeight,this.state.scrollWidth=this._scrollingContainerRef.scrollingElement.scrollWidth;const{initialScroll:r}=this.props;r&&p(this,{scrollTop:r.top,scrollLeft:r.left}),this._onCleanup(),this._scrollingContainerRef.registerEventListener.addEventListener("scroll",l),this.state.cleanup.push((()=>{var e,t;null===(t=null===(e=this._scrollingContainerRef)||void 0===e?void 0:e.registerEventListener)||void 0===t||t.removeEventListener("scroll",l)})),v(this)},this._onPropsChange=function(e){this.props=e;const{state:{isLoading:t},props:{rowCount:o,columnCount:l,hasMore:r},_scrollingContainerRef:n}=this;n&&(void 0===o&&(r.down||r.up)&&console.warn(`You provided props with "hasMore: { up: ${!!r.up}, down: ${!!r.down} }" but "rowCount" is "undefined"`),void 0===l&&(r.left||r.right)&&console.warn(`You provided props with "hasMore: { left: ${!!r.left}, right: ${!!r.right} }" but "columnCount" is "undefined"`),t||v(this))},this._onCleanup=function(){const{state:{cleanup:e}}=this;e.length&&(e.forEach((e=>e())),this.state.cleanup=[])},this.setRef=this._setRef.bind(this),this.onPropsChange=this._onPropsChange.bind(this),this.onCleanup=this._onCleanup.bind(this),this.props=e,this.state={rowCount:e.rowCount,columnCount:e.columnCount,scrollHeight:0,scrollWidth:0,clientHeight:0,clientWidth:0,isLoading:!1,computedScrollThreshold:{vertical:0,horizontal:0},thresholdReached:{},cleanup:[]}}}exports.InfiniteScroll=m,exports.checkOffsetAndLoadMore=v,exports.computeThreshold=s,exports.default=e=>{const t=o.useRef(null),{rowCount:l,columnCount:r,hasMore:{up:n,down:i,left:s,right:c},next:a,windowScroll:h}=e,{current:{setRef:u,onPropsChange:d,onCleanup:p}}=o.useRef(new m(e));return o.useEffect((()=>(u(h?null:t.current),p)),[t.current]),o.useEffect((()=>d(e)),[l,r,n,i,s,c,a]),t},exports.getMultiplierSign=l,exports.getPossibleLoadDirections=h,exports.getScrollingContainerRef=n,exports.getValidScrollValue=r,exports.isValidScrollingContainerRef=i,exports.loadByDirection=g,exports.onLoadComplete=f,exports.resetReachedThreshold=d,exports.scroll=p;
