import{useRef as t,useEffect as e}from"react";var o,n;!function(t){t.VERTICAL="vertical",t.HORIZONTAL="horizontal"}(o||(o={})),function(t){t.UP="up",t.DOWN="down",t.LEFT="left",t.RIGHT="right"}(n||(n={}));const l=t=>"number"==typeof t?t<0?-1:1:t?-1:1,i=({newValue:t,scrollSize:e,fallbackValue:o})=>{const n=null!=o?o:e*l(t);return Math.abs(t)>e?n:t},r=({ref:t,windowScroll:e})=>{const o={scrollingElement:null,registerEventListener:null};if(!e&&t){let e=null;"_scrollingContainer"in t&&(e=t._scrollingContainer),"Grid"in t&&(e=t.Grid._scrollingContainer),"scrollHeight"in t&&(e=t),o.scrollingElement=e,o.registerEventListener=e}else e&&(o.scrollingElement=document.scrollingElement,o.registerEventListener=document);return o},s=t=>{const{scrollingElement:e,registerEventListener:o}=t;return!(e&&o&&("number"!=typeof e.scrollHeight||"number"!=typeof e.scrollWidth||"number"!=typeof e.scrollLeft||"number"!=typeof e.scrollTop||"number"!=typeof e.clientHeight||"number"!=typeof e.clientWidth||"function"!=typeof o.addEventListener||"function"!=typeof o.removeEventListener)||!e||!o)||(console.error("Sorry I can't use this container - try using a different DOM element."),!1)},c=t=>{const{state:{clientWidth:e,clientHeight:o},props:{scrollThreshold:n=1},_scrollingContainerRef:l}=t;if(!(null==l?void 0:l.scrollingElement)||e===l.scrollingElement.clientWidth&&o===l.scrollingElement.clientHeight)return;const{clientWidth:r,clientHeight:s,scrollHeight:c,scrollWidth:a}=l.scrollingElement;let h={vertical:0,horizontal:0};if("string"==typeof n){const t=Math.abs(parseInt(n));h={vertical:i({newValue:t,scrollSize:c,fallbackValue:s}),horizontal:i({newValue:t,scrollSize:a,fallbackValue:r})}}else{const t=n>1?1:n<=0?.1:n;h={vertical:t*s,horizontal:t*r}}t.state.computedScrollThreshold=h,t.state.clientWidth=r,t.state.clientHeight=s},a=(t,e,o)=>Math.abs(t)<=e-o,h=(t,e,o,n,l)=>Math.abs(t)>=Math.abs(e-o-n-l),u=(t,e)=>{var o;c(t);const l=null!==(o=null==e?void 0:e.offset)&&void 0!==o?o:0,{state:{clientHeight:i,clientWidth:r,computedScrollThreshold:{vertical:s,horizontal:u}},props:{reverse:d={}},_scrollingContainerRef:f}=t;if(!(null==f?void 0:f.scrollingElement))return Object.values(n).reduce(((t,e)=>Object.assign(Object.assign({},t),{[e]:!1})),{});const{scrollHeight:g,scrollWidth:p,scrollLeft:v,scrollTop:m}=f.scrollingElement,{column:C,row:E}=d;return{[C?n.DOWN:n.UP]:a(m,s,l),[C?n.UP:n.DOWN]:h(m,g,i,s,l),[E?n.RIGHT:n.LEFT]:a(v,u,l),[E?n.LEFT:n.RIGHT]:h(v,p,r,u,l)}};function d(t,e,o,n){return new(o||(o=Promise))((function(l,i){function r(t){try{c(n.next(t))}catch(t){i(t)}}function s(t){try{c(n.throw(t))}catch(t){i(t)}}function c(t){var e;t.done?l(t.value):(e=t.value,e instanceof o?e:new o((function(t){t(e)}))).then(r,s)}c((n=n.apply(t,e||[])).next())}))}const f=(t,{direction:e,offset:o,hardReset:n})=>{(!u(t,{offset:o})[e]&&t.state.thresholdReached[e]||n)&&(t.state.thresholdReached[e]=!1)},g=(t,{scrollTop:e,scrollLeft:o})=>{var n;if(!(null===(n=t._scrollingContainerRef)||void 0===n?void 0:n.scrollingElement))return;const{scrollHeight:l,scrollWidth:r}=t._scrollingContainerRef.scrollingElement;void 0!==e&&(t._scrollingContainerRef.scrollingElement.scrollTop=i({newValue:e,scrollSize:l})),void 0!==o&&(t._scrollingContainerRef.scrollingElement.scrollLeft=i({newValue:o,scrollSize:r}))},p=(t,{axis:e,loadMore:i})=>{var r;if(!(null===(r=t._scrollingContainerRef)||void 0===r?void 0:r.scrollingElement)||!t.state.isLoading)return;const s=e===o.VERTICAL,{state:{rowCount:c=0,columnCount:a=0,scrollHeight:h,scrollWidth:u},props:{rowCount:d=0,columnCount:p=0,reverse:v={}},_scrollingContainerRef:m}=t,{scrollTop:C,scrollLeft:E,scrollHeight:w,scrollWidth:R,clientHeight:L,clientWidth:H}=m.scrollingElement,T=s?d:p,_=s?C:E,b=s?w:R,W=s?h:u,y=s?L:H;if((s?c:a)!==T&&Math.abs(_)<y){const e=l(v[s?"column":"row"]);g(t,{["scroll"+(s?"Top":"Left")]:_+(b-W)*e})}Object.values(n).forEach((e=>f(t,{direction:e}))),t.state[s?"scrollHeight":"scrollWidth"]=b,t.state[s?"rowCount":"columnCount"]=T,t.state.isLoading=!1,setTimeout((()=>i(t)),100)},v=(t,{positiveDirection:e,negativeDirection:l,offset:i,loadMore:r})=>d(void 0,void 0,void 0,(function*(){const{state:{isLoading:s,thresholdReached:c},props:{next:a,hasMore:h}}=t,u=e===n.UP?o.VERTICAL:o.HORIZONTAL;if(!s){const o=h[e]&&!c[e]&&i[e],n=!o&&h[l]&&!c[l]&&i[l];if(o||n)try{const n=o?e:l;t.state.thresholdReached[n]=!0,t.state.isLoading=!0,yield a(n)}finally{setTimeout((()=>p(t,{axis:u,loadMore:r})),100)}}})),m=t=>{const{_scrollingContainerRef:e}=t;if(!e)return;t.state.isLoading||Object.values(n).forEach((e=>f(t,{direction:e,offset:0,hardReset:!0})));const o=u(t);v(t,{positiveDirection:n.UP,negativeDirection:n.DOWN,offset:o,loadMore:m}),v(t,{positiveDirection:n.LEFT,negativeDirection:n.RIGHT,offset:o,loadMore:m})};class C{constructor(t){this._setRef=function(t){const{windowScroll:e}=this.props,o=r({ref:t,windowScroll:e});if(!s(o))return;this._scrollingContainerRef=o;const n=()=>{var t;if(!(null===(t=this._scrollingContainerRef)||void 0===t?void 0:t.scrollingElement))return;const{_scrollingContainerRef:{scrollingElement:e},props:{onScroll:o}}=this,{scrollHeight:n,scrollWidth:l,scrollLeft:i,scrollTop:r,clientHeight:s,clientWidth:c}=e;o&&o({clientHeight:s,clientWidth:c,scrollHeight:n,scrollWidth:l,scrollLeft:i,scrollTop:r}),this.state.isLoading||m(this)};this.state.rowCount=this.props.rowCount,this.state.columnCount=this.props.columnCount,this.state.scrollHeight=this._scrollingContainerRef.scrollingElement.scrollHeight,this.state.scrollWidth=this._scrollingContainerRef.scrollingElement.scrollWidth;const{initialScroll:l}=this.props;l&&g(this,{scrollTop:l.top,scrollLeft:l.left}),this._onCleanup(),this._scrollingContainerRef.registerEventListener.addEventListener("scroll",n),this.state.cleanup.push((()=>{var t,e;null===(e=null===(t=this._scrollingContainerRef)||void 0===t?void 0:t.registerEventListener)||void 0===e||e.removeEventListener("scroll",n)})),m(this)},this._onPropsChange=function(t){this.props=t;const{state:{isLoading:e},props:{rowCount:o,columnCount:n,hasMore:l},_scrollingContainerRef:i}=this;i&&(void 0===o&&(l.down||l.up)&&console.warn(`You provided props with "hasMore: { up: ${!!l.up}, down: ${!!l.down} }" but "rowCount" is "undefined"`),void 0===n&&(l.left||l.right)&&console.warn(`You provided props with "hasMore: { left: ${!!l.left}, right: ${!!l.right} }" but "columnCount" is "undefined"`),e||m(this))},this._onCleanup=function(){const{state:{cleanup:t}}=this;t.length&&(t.forEach((t=>t())),this.state.cleanup=[])},this.setRef=this._setRef.bind(this),this.onPropsChange=this._onPropsChange.bind(this),this.onCleanup=this._onCleanup.bind(this),this.props=t,this.state={rowCount:t.rowCount,columnCount:t.columnCount,scrollHeight:0,scrollWidth:0,clientHeight:0,clientWidth:0,isLoading:!1,computedScrollThreshold:{vertical:0,horizontal:0},thresholdReached:{},cleanup:[]}}}const E=o=>{const n=t(null),{rowCount:l,columnCount:i,hasMore:{up:r,down:s,left:c,right:a},next:h,windowScroll:u}=o,{current:{setRef:d,onPropsChange:f,onCleanup:g}}=t(new C(o));return e((()=>(d(u?null:n.current),g)),[n.current]),e((()=>f(o)),[l,i,r,s,c,a,h]),n};export{C as InfiniteScroll,o as ScrollAxisName,n as ScrollDirection,m as checkOffsetAndLoadMore,c as computeThreshold,E as default,l as getMultiplierSign,u as getPossibleLoadDirections,r as getScrollingContainerRef,i as getValidScrollValue,s as isValidScrollingContainerRef,v as loadByDirection,p as onLoadComplete,f as resetReachedThreshold,g as scroll};
